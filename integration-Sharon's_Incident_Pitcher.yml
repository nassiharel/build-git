category: testing
commonfields:
  id: Sharon's Incident Pitcher
  version: -1
configuration:
- display: Fetch incidents
  name: isFetch
  required: false
  type: 8
- display: Incident type
  name: incidentType
  required: false
  type: 13
- display: Incident name prefix
  name: name_prefix
  required: false
  type: 0
- additionalinfo: List of key names, separated by comma
  display: Keys for random strings
  name: random_string_keys
  required: false
  type: 0
- additionalinfo: List of key names, separated by comma
  display: Keys for random ints
  name: random_int_keys
  required: false
  type: 0
- display: The raw JSON string that will be the static part of the incidents
  name: JSON
  required: false
  type: 12
- defaultvalue: "1"
  display: Incidents Fetch Interval
  name: incidentFetchInterval
  required: false
  type: 19
contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: ""
    itemVersion: ""
    packID: ""
    packName: ""
    propagationLabels: []
    toServerVersion: ""
description: This is an integration that generates semi-random incidents based on
  give configuration
detaileddescription: Talk to Sharon Harel-Eilam for more details
display: Sharon's Incident Pitcher
image: data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAF8ElEQVRo3tVaa2wUVRQ+lUeolLZQHwQxEUIi/GgpakvTst2d7fax7RaEUFOIRW2x7e7cme220BawNSQ1MQZFgYaH8gvlFVAxUYIIJPxRA7FSLCpBJMYnL5FEyh8cvzttodvd6e527izpJCezO3Pn3Pvde853zzkzRKKPAmUOScp+Kg/MoVF7FCiZJLHz5JA1nL8jlzxzxLoklgw908iBc5xBZKPTSzqIAcmvPU3Ltk+NSc/S5vGUz9YASBd0XIXOb2jpKm+cQDAnOvw9CAQXm1ej0ubj9PW5yVHpaXplLJU3bKN83xA9+F+gtJAnkGAdCIm50dm1EBADYgeYrJrDlF0d2UTscj7ZfXcMdN2kJW2PWwPCIZdC/jYEESwHATopwsquHVZHgb9IPAinvhI3owTRJ5L8ITm8xisjye8N+7xLtQk2JyUHPnElJhB3CcB7hCpff9TATI8bPmfzXUCfqeJAuPyzoPinEYEYkMKGr8jtnztkhbmZ3gr1MYiTXaPFgWKRFDuenMpBUyD0wemsBGqVt2EVWmgRmMoh3wjTthdAdlGpP120cz8EO/7FNJBQswm95mR7qKTBoujAqUzADJ4QDiREWDe5lInWbn5FgWysyiEAOmNgDuZFkt+N107+AGw3hUrU6VSsLsTvo4LBHMFEJVDcD7syBh1vEQikFz5SRPflkNRU2PY5cebF/oBPLjM/sMWBVEShKpRuJxeLjsMdyibx/sL2UUXHCNmrtiUZ9n/0bhSaW3uL1A2RuVxiqy1ismvQvR7ycKxx1GuUP0hRdo1GLVvfjsK8NlpMzRdhbowKlSmRQVSumg/kt4csr0Y5dZepyvuEMXh/Ctr1kA1t56vDC28jmaLnbkQZ9VSoJhqxzzh08rmhguyXPqI9xxINzOotPsDkhbXavMZlWmZgeVjh93gbHYx5//kWYFZQkfLg0P2hAg3+M3xwQb1GFe0nacVaDz3XOB3m9xiU5UP64i/M9rzG5dq+6xnanqsZ2u4rc4OEX+P3eBt9ZYQRgnf/4IAwERe7IsyARnl1PBTX9IRKYteD7mNwfNb5gD+4nKG9/9fcIOHX+D3eRggQbp42Pp616wYBUVeaVtwPhM8+H/iuPzODhF/j94QB4RNaFviR1h1K6wPxYkcyZvqHUQckC2y6utN3bzWatzDKqtZGHZDcuh56oWNSH4h3dqRRSdP5frsfXUAkVn1vNTxyO+V5zfG6GGe/ohMIn1BOKFJEej5NBfKEwfHRAWE0OBL6ldh+0H4ussRpOqVXrfFQRdtJneqN+7qD+G9J8N7hbkzEalRBusynrDFuiE7lzbCbK990s6s/Ns732WGkweMMQgxs95JSB0BnzPF61CHKWVC+cY1rZWAG5fmuhs1Vlq96JprsbzLyZRmoL1gaADrZGxHHsiSwKagwwUtDLmV9rBEwKiasvb9sY0FezgIRx/BsUybCoN5Bz32G2CppZLlJTfNssrO94sEoG6MrCLIytN8KS/EB/CQBNS1WCflNIJgeOHvKfcrLlULd2YT5ibwZ5zHxB+JAicbBjgg1MV5KcjcuIk/TdFBrKnwzTsCcyk6LmIynBd04f0Lu1qctNi05CZ2dtbxkKiknyNmQaA0Il5qOTkLDmZyXrQDzMyRNLACPmgmlu+Ebt0MTG991Yhs6sUM34n6nvufYTfsMJ4G9VMjGigNR0+LRbTf84P4lW31wWdOtZlCx8qUpMPw9fZEyUxyI1rYpCA8uGQ5Kkr8I+5y39RFa4Ds8QiCXwVpZYk2q1C9FeIexw/BZm5yMmY01PbgBJ7egcF3oLxnWjl1Kc4Ty6USAPRBDSbTYGpZqacMGJf8TvnqBxEaS8yLqyKpJhnyqfzRgHPrzzzQsfIWweE0CuHw12euHMpVG5f7N+Nwiuh2Yf77hbj6mf84Rap6/YoO1x2cnL3m1Dp2e0h1RwtkuB5CSxhZGPL9zKj4UONX/NncAxEWS/E/FOcaSJ+mfHDlNhNFlrTP0l5x9weL38LF0GrWHq2m2/uLGpT4pWvX/zRDqQjZWrVoAAAAASUVORK5CYII=
name: Sharon's Incident Pitcher
script:
  commands:
  - arguments:
    - description: a string to convert
      name: the_string
      required: true
      type: textArea
    description: return string in language b
    name: language-b-me
  dockerimage: demisto/python3:3.9.8.24399
  isfetch: true
  runonce: false
  script: |
    import string
    import json
    import random

    import traceback
    from typing import Any, Dict, Tuple, List, Optional, cast
    from datetime import datetime

    ''' CONSTANTS '''

    HELLOWORLD_SEVERITIES = ['Low', 'Medium', 'High', 'Critical']

    ''' HELPER FUNCTIONS '''


    def generate_random_string(max_chars_per_part: int = 20, max_path_parts: int = 6) -> str:
        bag_of_chars = string.ascii_lowercase + string.digits

        num_of_words = random.randint(1, max_path_parts)

        list_of_words = []
        for _ in range(num_of_words):
            word = ''.join(random.choices(bag_of_chars, k=random.randint(1, max_chars_per_part)))
            list_of_words.append(word)

        list_of_words = [word.strip() for word in list_of_words]

        return ' '.join(list_of_words)


    ''' COMMAND FUNCTIONS '''


    def test_module():
        return 'ok'


    def language_b_me(args: Dict[str, Any]) -> CommandResults:
        the_string = args.get('the_string', None)
        if not the_string:
            raise ValueError('the_string not specified')

        result_string = 'b'.join(str(the_string))

        as_markdown = f'# {result_string}\n#### {the_string}'

        return CommandResults(
            readable_output=as_markdown,
            outputs_prefix='fii',
            outputs_key_field='',
            outputs=result_string
        )


    def fetch_incidents(static_data: dict, name_prefix: str, string_keys:str, int_keys:str):
        demisto.debug('going to generate a new random incident')
        now = datetime.utcnow().timestamp()

        incident_json = static_data

        incident_name = f'Random Generated Incident-{generate_random_string(5, 1)}'
        if name_prefix:
            incident_name = f'{name_prefix}-{incident_name}'

        if string_keys:
            keys = string_keys.split(',')
            for key in keys:
                incident_json[key] = generate_random_string()

        if int_keys:
            keys = int_keys.split(',')
            for key in keys:
                incident_json[key] = random.randint(0, 10000)

        incident = {
            'name': incident_name,
            'occurred': timestamp_to_datestring(now),
            'rawJSON': json.dumps(incident_json),
            'severity': random.choice([IncidentSeverity.MEDIUM, IncidentSeverity.HIGH, IncidentSeverity.LOW]),
        }

        next_run = {'last_fetch': now}
        return next_run, [incident]


    ''' MAIN FUNCTION '''


    def main() -> None:
        demisto.debug(f'Command being called is {demisto.command()}')
        try:
            if demisto.command() == 'test-module':
                # This is the call made when pressing the integration Test button.
                result = test_module()
                return_results(result)

            elif demisto.command() == 'fetch-incidents':
                static_data = json.loads(demisto.params().get('JSON'))
                name_prefix = demisto.params().get('name_prefix')
                string_keys = demisto.params().get('random_string_keys', None)
                int_keys = demisto.params().get('random_int_keys', None)
                next_run, incidents = fetch_incidents(static_data, name_prefix, string_keys, int_keys)

                demisto.setLastRun(next_run)
                demisto.incidents(incidents)

            elif demisto.command() == 'language-b-me':
                return_results(language_b_me(demisto.args()))

        # Log exceptions and return errors
        except Exception as e:
            demisto.error(traceback.format_exc())  # print the traceback
            return_error(f'Failed to execute {demisto.command()} command.\nError:\n{str(e)}')


    ''' ENTRY POINT '''

    if __name__ in ('__main__', '__builtin__', 'builtins'):
        main()
  subtype: python3
  type: python
